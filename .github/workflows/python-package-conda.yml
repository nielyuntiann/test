name: proxy-ngrok-runner

on:
  workflow_dispatch:

jobs:
  proxy-ngrok:
    runs-on: ubuntu-latest
    timeout-minutes: 60   # keep low; this job is holding an open tunnel

    steps:
      - name: Check out repo
        uses: actions/checkout@v4

      - name: Show runner public IP
        run: |
          echo "Public IP (if reachable via ipinfo.io):"
          curl -s https://ipinfo.io/ip || true

      - name: Install Python and proxy.py
        run: |
          python3 --version
          python3 -m pip install --upgrade pip
          python3 -m pip install proxy.py

      - name: Start proxy.py on port 8080
        run: |
          # HTTP/HTTPS proxy on 0.0.0.0:8080
          nohup python3 -m proxy \
            --hostname 0.0.0.0 \
            --port 8080 \
            --num-workers 1 \
            > proxy.log 2>&1 &
          sleep 3
          echo "proxy.py started on :8080"

          while true; do sleep 60; done
